<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>Real Estate Investment Calculator | Thomas Officer</title>
  <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet" type="text/css" />
  <link rel="icon" href="assets/tfo-favicon.ico" type="image/x-icon">
  <script>
    function saveInput(id) {
      var value = document.getElementById(id).value;
      localStorage.setItem(id, value);
    }

    function loadSavedInputs() {
      document.querySelectorAll('.calc input').forEach(input => {
        var savedValue = localStorage.getItem(input.id);
        if (savedValue) {
          input.value = savedValue;
        }
      });
      updateResults(); // Update results based on loaded inputs
    }

    window.onload = loadSavedInputs;

    function updateResults() {
      // Pull values from calculator
      var purchasePrice = parseFloat(document.getElementById('purchase-price').value);
      var downPaymentPercentage = parseFloat(document.getElementById('downpayment-percentage').value) || 100;
      var loanTerm = parseFloat(document.getElementById('loan-term').value);
      var interestRate = parseFloat(document.getElementById('interest-rate').value);
      var monthlyInterestRate = interestRate / 12 / 100; // Convert annual rate to a decimal monthly rate
      var totalPayments = loanTerm * 12;
      var rehabCost = parseFloat(document.getElementById('rehab-cost').value) || 0;
      var transferTax = parseFloat(document.getElementById('transfer-tax').value) || 0;
      var closingCost = parseFloat(document.getElementById('closing-cost').value) || 0;
      var loanPayment = parseFloat(document.getElementById('loan-payment').value) || 0;
      var propertyTaxes = parseFloat(document.getElementById('property-taxes').value) || 0;
      var homeInsurance = parseFloat(document.getElementById('home-insurance').value) || 0;
      var repairsMaintenance = parseFloat(document.getElementById('repairs-maintenance').value) || 0;
      var vacancy = parseFloat(document.getElementById('vacancy').value) || 0;
      var capex = parseFloat(document.getElementById('capex').value) || 0;
      var mgtFees = parseFloat(document.getElementById('mgt-fees').value) || 0;
      var hoaDues = parseFloat(document.getElementById('hoa-dues').value) || 0; 
      var electricity = parseFloat(document.getElementById('electricity').value) || 0;
      var gas = parseFloat(document.getElementById('gas').value) || 0;
      var water = parseFloat(document.getElementById('water').value) || 0;
      var garbage = parseFloat(document.getElementById('garbage').value) || 0;
      var monthlyIncome = parseFloat(document.getElementById('monthly-income').value) || 0;
      var appreciationRate = parseFloat(document.getElementById('appreciation-rate').value) / 100;
      var years = 20;

      function formatCurrency(value) {
        return new Intl.NumberFormat('en-US', {
          style: 'currency',
          currency: 'USD',
          maximumFractionDigits: 2
        }).format(value);
      }

      // Calculations
      var downPayment = purchasePrice * downPaymentPercentage / 100;
      var upfrontCost = rehabCost + downPayment || 0;
      var principal = purchasePrice - downPayment;
      var monthlyLoanPayment = (monthlyInterestRate * principal) / (1 - Math.pow(1 + monthlyInterestRate, - totalPayments)) || 0;
      var monthlyCost = loanPayment + propertyTaxes + homeInsurance + repairsMaintenance + vacancy + capex + mgtFees + hoaDues + electricity + gas + water + garbage;
      var annualOperatingExpenses = monthlyCost * 12;
      var monthlyCashflow = monthlyIncome - monthlyCost;
      var annualCashflow = monthlyCashflow * 12;
      var NOI = annualCashflow - annualOperatingExpenses;
      var capRate = (NOI / purchasePrice) * 100;

      // Set results
      document.getElementById('upfront-cost').innerText = formatCurrency(upfrontCost);
      document.getElementById('loan-payment').innerText = formatCurrency(monthlyLoanPayment);
      document.getElementById('cashflow-monthly').innerText = formatCurrency(monthlyCashflow);
      if (isNaN(appreciationRate)) {
          // If appreciation rate is not provided, set future value to empty or a placeholder
          document.getElementById('appreciation').innerText = 'N/A';
      } else {
          // Perform calculation if appreciation rate is provided
          var futureValue = purchasePrice * Math.pow(1 + appreciationRate, years);
          document.getElementById('appreciation').innerText = formatCurrency(futureValue);
      }
      document.getElementById('cashflow-annually').innerText = formatCurrency(annualCashflow);
      document.getElementById('cap-rate').innerText = capRate.toFixed(2) + '%';
    }
  </script>
</head>
</head>

<body>
  <div class="calc-nav">
    <div class="cal-nav__wrapper">
      <h1>Real Estate Investment Calculator</h1>
      <p>
        Generate and share back-of-the-napkin calculations for a propertyâ€™s rehab, financing, and income expectations.
      </p>    
    </div>
  </div>
  <div class="calc-main">
    <div class="calc-main__wrapper">
      <div class="calc">
        <div class="calc__header">
          <h5>
            Upfront costs
          </h5>
        </div>
        <div class="calc__row">
          <div class="calc__row__leftCol">
            <label for="purchase-price">Purchase price</label> 
          </div>
          <div class="calc__row__rightCol">
            <input type="number" id="purchase-price" oninput="updateResults(); saveInput('purchase-price')">
          </div>
        </div>
        <div class="calc__row">
          <div class="calc__row__leftCol">
            <label for="downpayment-percentage">Downpayment %</label> 
          </div>
          <div class="calc__row__rightCol">
            <input type="number" id="downpayment-percentage" oninput="updateResults(); saveInput('downpayment-percentage')">
          </div>
        </div>
        <div class="calc__row">
          <div class="calc__row__leftCol">
            <label for="loan-term">Loan term (years)</label> 
          </div>
          <div class="calc__row__rightCol">
            <input type="number" id="loan-term" oninput="updateResults(); saveInput('loan-term')">
          </div>
        </div>
        <div class="calc__row">
          <div class="calc__row__leftCol">
            <label for="interest-rate">Interest rate %</label> 
          </div>
          <div class="calc__row__rightCol">
            <input type="number" id="interest-rate" oninput="updateResults(); saveInput('interest-rate')">
          </div>
        </div>
        <div class="calc__row">
          <div class="calc__row__leftCol">
            <label for="rehab-cost">Rehab cost</label> 
          </div>
          <div class="calc__row__rightCol">
            <input type="number" id="rehab-cost" oninput="updateResults(); saveInput('rehab-cost')">
          </div>
        </div>
        <div class="calc__row">
          <div class="calc__row__leftCol">
            <label for="transfer-tax">Transfer tax</label> 
          </div>
          <div class="calc__row__rightCol">
            <input type="number" id="transfer-tax" oninput="updateResults(); saveInput('transfer-tax')">
          </div>
        </div>
        <div class="calc__row">
          <div class="calc__row__leftCol">
            <label for="closing-cost">Closing cost</label> 
          </div>
          <div class="calc__row__rightCol">
            <input type="number" id="closing-cost" oninput="updateResults(); saveInput('closing-cost')">
          </div>
        </div>
        <div class="calc__header">
          <h5>
            Income & Appreciation
          </h5>
        </div>
        <div class="calc__row">
          <div class="calc__row__leftCol">
            <label for="monthly-income">Monthly income</label> 
          </div>
          <div class="calc__row__rightCol">
            <input type="number" id="monthly-income" oninput="updateResults(); saveInput('monthly-income')">
          </div>
        </div>
        <div class="calc__row">
          <div class="calc__row__leftCol">
            <label for="appreciation-rate">Appreciation rate %</label> 
          </div>
          <div class="calc__row__rightCol">
            <input type="number" id="appreciation-rate" oninput="updateResults(); saveInput('appreciation-rate')">
          </div>
        </div>
        <div class="calc__header">
          <h5>
            Monthly costs
          </h5>
        </div>
        <div class="calc__row">
          <div class="calc__row__leftCol">
            <label for="loan-payment">Loan payment</label> 
          </div>
          <div class="calc__row__rightCol">
            <p id="loan-payment"></p>
          </div>
        </div>
        <div class="calc__row">
          <div class="calc__row__leftCol">
            <label for="property-taxes">Property taxes</label> 
          </div>
          <div class="calc__row__rightCol">
            <input type="number" id="property-taxes" oninput="updateResults(); saveInput('property-taxes')">
          </div>
        </div>
        <div class="calc__row">
          <div class="calc__row__leftCol">
            <label for="home-insurance">Home insurance</label> 
          </div>
          <div class="calc__row__rightCol">
            <input type="number" id="home-insurance" oninput="updateResults(); saveInput('home-insurance')">
          </div>
        </div>
        <div class="calc__row">
          <div class="calc__row__leftCol">
            <label for="repairs-maintenance">Repairs & maintenance</label> 
          </div>
          <div class="calc__row__rightCol">
            <input type="number" id="repairs-maintenance" oninput="updateResults(); saveInput('repairs-maintenance')">
          </div>
        </div>
        <div class="calc__row">
          <div class="calc__row__leftCol">
            <label for="vacancy">Vacancy</label> 
          </div>
          <div class="calc__row__rightCol">
            <input type="number" id="vacancy" oninput="updateResults(); saveInput('vacancy')">
          </div>
        </div>
        <div class="calc__row">
          <div class="calc__row__leftCol">
            <label for="capex">Capital expenditures</label> 
          </div>
          <div class="calc__row__rightCol">
            <input type="number" id="capex" oninput="updateResults(); saveInput('capex')">
          </div>
        </div>
        <div class="calc__row">
          <div class="calc__row__leftCol">
            <label for="mgt-fees">Management fees</label> 
          </div>
          <div class="calc__row__rightCol">
            <input type="number" id="mgt-fees" oninput="updateResults(); saveInput('mgt-fees')">
          </div>
        </div>
        <div class="calc__row">
          <div class="calc__row__leftCol">
            <label for="hoa-dues">HOA Dues</label> 
          </div>
          <div class="calc__row__rightCol">
            <input type="number" id="hoa-dues" oninput="updateResults(); saveInput('hoa-dues')">
          </div>
        </div>
        <div class="calc__row">
          <div class="calc__row__leftCol">
            <label for="electricity">Electricity</label> 
          </div>
          <div class="calc__row__rightCol">
            <input type="number" id="electricity" oninput="updateResults(); saveInput('electricity')">
          </div>
        </div>
        <div class="calc__row">
          <div class="calc__row__leftCol">
            <label for="gas">Gas</label> 
          </div>
          <div class="calc__row__rightCol">
            <input type="number" id="gas" oninput="updateResults(); saveInput('gas')">
          </div>
        </div>
        <div class="calc__row">
          <div class="calc__row__leftCol">
            <label for="water">Water / Sewer</label> 
          </div>
          <div class="calc__row__rightCol">
            <input type="number" id="water" oninput="updateResults(); saveInput('water')">
          </div>
        </div>
        <div class="calc__row">
          <div class="calc__row__leftCol">
            <label for="garbage">Garbage</label> 
          </div>
          <div class="calc__row__rightCol">
            <input type="number" id="garbage" oninput="updateResults(); saveInput('garbage')">
          </div>
        </div>      
      </div>
      <div class="results">
        <div class="results__header-row">
          <div class="results__header-row__col">
            <h3>
              Upfront cost
            </h3>
            <p id="upfront-cost">$0</p>
          </div>
          <div class="results__header-row__col">
            <h3>
              Cashflow
            </h3>
            <p><span id="cashflow-monthly">$0</span> per month</p>
            <p><span id="cashflow-annually">$0</span> per year</p>
          </div>
          <div class="results__header-row__col">
            <h3>
              Cap rate
            </h3>
            <p id="cap-rate">0</p>
          </div>
          <div class="results__header-row__col">
            <h3>
              Estimated value after 20 years
            </h3>
            <p id="appreciation">$0</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>
</html>